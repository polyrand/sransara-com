<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><title>Project Buddy Chess (utopia) — release v0.0 retrospective &mdash; sransara</title><link rel=stylesheet href=https://sransara.com/styles/main.min.css></head><body><main class="container leading-normal max-w-2xl mx-auto p-3"><div class="mb-6 text-sm font-mono"><span class="whitespace-no-wrap inline-block">/ <a class="underline text-blue-800 hover:text-blue-500" href=/>home/sransara</a></span>
<span class="whitespace-no-wrap inline-block">/ <a class="underline text-blue-800 hover:text-blue-500" href=/notes/>notes</a></span>
<span class="whitespace-no-wrap inline-block">/ <a class="underline text-blue-800 hover:text-blue-500" href=/notes/2020/>2020</a></span>
<span class="whitespace-no-wrap inline-block">/ $
<span class="text-gray-600 inline-block">cat /dev/urandom</span></span></div><h1 class="mb-2 text-5xl font-bold">Project Buddy Chess (utopia) — release v0.0 retrospective</h1><span class="mb-2 text-gray-500 text-xs">Published
by <span class=text-gray-800>Samodya R. Abeysiriwardane</span>
on <span class=text-gray-800>Dec 10, 2020</span>
&nbsp;/&nbsp;<a class="underline text-blue-800 hover:text-blue-500" target=_blank rel="noopener noreferrer" href=https://github.com/sransara/sransara-com/tree/master/content/notes/2020/project-buddy-chess-utopia-release-v0.0-retrospective/>Source</a>
&nbsp;/&nbsp;<a class="underline text-blue-800 hover:text-blue-500" href=https://sransara.com/notes/2020/project-buddy-chess-utopia-release-v0.0-retrospective/>Permalink</a></span><hr class="my-2 border-2 border-gray-700"><div id=article class=asciidoc><div class=paragraph><p>I made a thing over the last few weeks; <a href=https://utopia.buddychess.com/ target=_blank rel=noopener>Buddy Chess (utopia)</a>: A friendly place for your <a href=https://en.wikipedia.org/wiki/Bughouse_chess target=_blank rel=noopener>bughouse chess</a> needs.
Here I will try to compile my notes and retrospective thoughts for future reference.</p></div><div class=sect1><h2 id=id:a-friendly-bughouse-chess-server-buddy-chess-utopia><a class=anchor href=#id:a-friendly-bughouse-chess-server-buddy-chess-utopia></a>A friendly bughouse chess server: Buddy Chess (utopia)</h2><div class=sectionbody><div id=image:buddy-chess-utopia-screenshot class=imageblock><div class=content><img src=buddy-chess-utopia-screenshot.png alt="buddy chess utopia screenshot"></div><div class=title>Figure 1. Buddy Chess (utopia) in action</div></div><div class=sect2><h3 id=id:what-is-bughouse-chess><a class=anchor href=#id:what-is-bughouse-chess></a>What is bughouse chess?</h3><div class=quoteblock><blockquote><div class=paragraph><p>Bughouse is the <em>funnest</em> of chess variations (citation not needed).</p></div><div class=paragraph><p>Breaking the solitary mold of chess, bughouse is a chess variation that lets you team up with a buddy for a fast paced chess game where you use your superior strategy and communication to slip through the cracks of opponents defenses.</p></div><div class=paragraph><p> — <a href=https://utopia.buddychess.com/ target=_blank rel=noopener>Buddy Chess (utopia)</a></p></div></blockquote></div><div class=paragraph><p>Bughouse is usually played in teams of two. In the seating layout (<a href=#image:bughouse-seating-layout>Figure 2</a>), your team mate sits to your side and holds the same color pieces as your opponent.</p></div><div id=image:bughouse-seating-layout class=imageblock><div class=content><img src=bughouse-seating-layout.png alt="bughouse seating layout"></div><div class=title>Figure 2. Bughouse seating layout</div></div><div class=paragraph><p>Two main twists are introduced to the usual chess rules.</p></div><div class="olist arabic"><ol class=arabic><li><p>All pieces that you capture on your board will be passed to your team mate. You can think of it as these pieces go to your team mate’s spare piece stash.</p></li><li><p>On your turn you can drop a piece from your spare stash on to your board.</p></li></ol></div><div class=paragraph><p>That’s pretty much it. Read more thoroughly about <a href=https://en.wikipedia.org/wiki/Bughouse_chess target=_blank rel=noopener>bughouse on wikipedia</a>.</p></div></div></div></div><div class=sect1><h2 id=id:backstory><a class=anchor href=#id:backstory></a>Backstory</h2><div class=sectionbody><div class=paragraph><p><a href=http://lichess.org target=_blank rel=noopener>Lichess</a> is my favourite online chess site due to its <a href=https://lichess.org/blog/U4skkUQAAEAAhIGz/why-is-lichess-free target=_blank rel=noopener>ideals</a>.
But sadly lichess team is reluctant to add my favorite chess variation (for good reasons).</p></div><div class=quoteblock><blockquote><div class=paragraph><p>Clocks, time controls and ending conditions are the hardest things on the impl side.
It’s all doable but not a priority because it would make lichess more difficult to maintain and variants are less than 1% of site traffic in general.</p></div><div class=paragraph><p>We’re trying to avoid adding potentially unpopular variants that add complexity to the site, and the bughouse exceptions for mates and clock start are significant.</p></div><div class=paragraph><p> — isaacly (lichess contributor) <a href=https://lichess.org/forum/team-fics-bughouse/lichess-bughouse-petition#3 class=bare>https://lichess.org/forum/team-fics-bughouse/lichess-bughouse-petition#3</a></p></div></blockquote></div><div class=paragraph><p>Chess.com which has done a great deal for the online chess boom has released support for <a href=https://www.chess.com/bughouse target=_blank rel=noopener>online bughouse</a>.
But the UX for a simple game with just 4 friends needs more love.</p></div><div class=paragraph><p>There was an <a href="https://www.youtube.com/watch?v=Q2oxnkwvO_E&t=1s" target=_blank rel=noopener>experimental fork</a> of lichess for bughouse at www.bughousetest.com.
The site was dead the last time I checked.
During the days it was live there was a small but dedicated community running weekly tournaments.
If I were to speculate why the site is dead now, I would say the maintence burden of the site was not worth it for the amount of site activity.</p></div><div class=paragraph><p>With all that said I wanted to add in my own spin to the mix focusing on friendly matches.</p></div></div></div><div class=sect1><h2 id=id:goals><a class=anchor href=#id:goals></a>Goals</h2><div class=sectionbody><div class=dlist><dl><dt class=hdlist1>Playable multiplayer bughouse</dt><dd><div class=ulist><ul><li><p>Obviously implement the game logic</p></li><li><p>But also have proper UI with</p><div class=ulist><ul><li><p>Full dual board display fitting into the screen</p></li><li><p>Clock, spare stash and profile view</p></li><li><p>Text and voice chat</p></li></ul></div></li></ul></div></dd><dt class=hdlist1>Reduce maintanence burden</dt><dd><div class=ulist><ul><li><p>Try to keep server costs at $0</p><div class=ulist><ul><li><p>so there’s no reason to shutdown the site for inactivity</p></li></ul></div></li><li><p>Be careful about features considered to be in scope</p><div class=ulist><ul><li><p>Keep matchmaking out of scope</p></li><li><p>Keep anti cheat mechanisms out of scope</p></li><li><p>Keep profiles and leader boards out of scope (these usually attracts cheaters)</p></li></ul></div></li></ul></div></dd><dt class=hdlist1>Target the casual bughouse chess community</dt><dd><div class=ulist><ul><li><p>As a place to play couple of bughouse matches among a group of friends</p></li></ul></div></dd><dt class=hdlist1>Learn a thing or two along the way</dt><dd><div class=ulist><ul><li><p>It is a side project after all</p></li></ul></div></dd></dl></div></div></div><div class=sect1><h2 id=id:plan-and-execution><a class=anchor href=#id:plan-and-execution></a>Plan and execution</h2><div class=sectionbody><div class="olist arabic"><ol class=arabic><li><p>Build an invitational game room system</p></li><li><p>Use P2P message passing for communication and reduce reliance on a central server</p></li><li><p>Extend chess library with bughouse rules</p></li><li><p>Put together bughouse chess board user interface</p></li><li><p>Stitch everything together into a cohesive system</p></li><li><p>Reaching out to the community</p></li></ol></div></div></div><div class=sect1><h2 id=id:notes><a class=anchor href=#id:notes></a>Notes</h2><div class=sectionbody><div class=dlist><dl><dt class=hdlist1>How to design a website that inevitably needs a lot of horizontal real estate?</dt><dd><div class=ulist><ul><li><p>For bughouse it is important to be able to view both chess boards in a single screen preferrably with out the need to scroll around.</p></li><li><p>My current solution is by making bold assumptions about the screen ratios.</p></li><li><p>I need to look in to how other games that support different screen ratios pull this off, especially for mobile UI.</p></li></ul></div></dd><dt class=hdlist1>Should I have had tried to keep server costs at $0?</dt><dd><div class=ulist><ul><li><p><strong>Cons:</strong> In hind sight I realize that I had cut too many corners in the name of keeping costs down.
I did get to play around with technology like WebRTC.
But at the end of the day players are coming to play bughouse chess and not WebRTC.</p></li><li><p><strong>Pros:</strong> Let me validate the idea, get an idea about the problem space and get some feedback.
Staying true to the initial goal of keeping costs at $0, this version can be kept alive even in the case that I lose steam behind the project.</p></li></ul></div></dd><dt class=hdlist1>Multiplayer player base</dt><dd><div class=ulist><ul><li><p>As a multiplayer game, it is crucial to have an active player base.</p></li><li><p>Question yet to be answered is if the online bughouse player base is big enough.</p></li><li><p>Before working on a next release, I need to survey current active community to undrestand what are their needs. With this release in my showcase, hopefully I do have some credibility on the matter.</p></li><li><p>We also do have to consider that any casual online chess player is a potential bughouse player.</p></li></ul></div></dd><dt class=hdlist1>Matchmaking</dt><dd><p>Matchmaking is a major pain point for the players.
Both in terms of finding opponents and also in finding good partners.
For this release I side stepped the problem by letting the players do the match making work themselves.
But if we are to get serious matchmaking is problem that needs to be addresssed properly.</p></dd></dl></div></div></div><div class=sect1><h2 id=id:built-on-shoulders-of-giants><a class=anchor href=#id:built-on-shoulders-of-giants></a>Built on shoulders of giants</h2><div class=sectionbody><div class=dlist><dl><dt class=hdlist1>Chessboard - <a href=https://github.com/ornicar/chessground target=_blank rel=noopener>chessground</a></dt><dd><p>Chessground by the lichess team is a battle tested project used in production at lichess.
The API code is fully typed and commented which more than made up for lack of a manual.
I had a hard time understanding themes and css styles.
But there is enough examples provided to experiment and prototype.</p></dd><dt class=hdlist1>Original chess rules - <a href=https://github.com/jhlywa/chess.js target=_blank rel=noopener>chess.js</a></dt><dd><p>We need to extend traditional chess rules with bughouse chess rules.
More specifically piece drop conditions and mating conditions.
Another good option that I didn’t get to evaluate is <a href=https://github.com/veloce/scalachessjs target=_blank rel=noopener>schala-chess</a> by the lichess team.</p></dd><dt class=hdlist1>WebRTC: for P2P - <a href=https://github.com/feross/simple-peer target=_blank rel=noopener>simple-peer</a></dt><dd><p>After spending many hours on an iteration using the pure WebRTC API, I ran into browser compatibility quirks.
So I decided to use a library that provides a nice abstraction on top of the WebRTC API.</p></dd><dt class=hdlist1>Firebase: for peer discovery and signaling - <a href=https://firebase.google.com target=_blank rel=noopener>firebase</a></dt><dd><p>To initiate a WebRTC connection between two peers we need a medium for them to communicate their handshake messages (known as signaling in WebRTC speak).
This is probably the cheaper choice (stay within $0 budget), but the more sensible choice would have been to use a backend with websockets for real time communication.</p></dd><dt class=hdlist1>Assymetric encryption for public channels - <a href=https://github.com/dchest/tweetnacl-js target=_blank rel=noopener>tweetnacl-js</a></dt><dd><p>Handshake messages contains sensitive information like IP address and device capabilities.
Many online tutorials that I saw on using firebase as a signaling server seemed to gloss over this privacy leakage.
My solution to this problem was to use assymetric encryption using transient private-public keys for each player session.</p></dd><dt class=hdlist1>Frontend - <a href=https://svelte.dev/ target=_blank rel=noopener>svelte</a> and <a href=https://tailwindcss.com/ target=_blank rel=noopener>tailwind-css</a></dt><dd><p>I have used this combination for couple of projects now, so I have gotten comfortable with them.
At the moment I prefer the svelte’s approach to reactive front end as it keeps development simple.
I also like the premise of tailwind’s utility first functional css approach.</p></dd><dt class=hdlist1>Github actions: for continous deployment - <a href=https://github.com/features/actions target=_blank rel=noopener>github actions</a></dt><dd><p>Github actions is free for light usage and easy enough to setup.</p></dd></dl></div></div></div></div></main><script>(function(){})();</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "7e685cdfbe6e496396ca70a124dadd1a"}'></script></body></html>